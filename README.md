# H1-ThreeJS-Frontend

å·¥ä¸šçº§ä¸‰ç»´å¯è§†åŒ–å‰ç«¯å¹³å° - åŸºäº Nuxt 3 + Three.js çš„ BIM/GIS èåˆè§£å†³æ–¹æ¡ˆ

## ğŸŒŸ é¡¹ç›®ç®€ä»‹

H1-ThreeJS-Frontend æ˜¯ä¸€ä¸ªé¢å‘å·¥ä¸šåœºæ™¯çš„ä¸“ä¸šä¸‰ç»´å¯è§†åŒ–å¹³å°ï¼Œä¸“æ³¨äºå»ºç­‘ä¿¡æ¯æ¨¡å‹(BIM)ä¸åœ°ç†ä¿¡æ¯ç³»ç»Ÿ(GIS)çš„æ·±åº¦èåˆã€‚å¹³å°æä¾›ä»è®¾è®¡åˆ°æ–½å·¥å…¨ç”Ÿå‘½å‘¨æœŸçš„æ•°å­—åŒ–è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒ IFC æ¨¡å‹æ¸²æŸ“ã€å·¥è‰ºæµç¨‹ç®¡ç†ã€ä¸‰ç»´åœ°ç†åˆ†æç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

**å‰ç«¯æ¡†æ¶**

- ğŸ”„ **Nuxt 3.19.2** - åŸºäº Vue 3.5.14 çš„ç°ä»£åŒ– SPA æ¡†æ¶
- âš¡ **Vue 3 Composition API** - å“åº”å¼ç¼–ç¨‹èŒƒå¼
- ğŸ“˜ **TypeScript 5.8.3** - ä¸¥æ ¼çš„ç±»å‹å®‰å…¨ä¿éšœ

**3D å¯è§†åŒ–**

- ğŸ¨ **Three.js 0.180.0** - WebGL 3D æ¸²æŸ“å¼•æ“
- ğŸ—ï¸ **IFC.js** - å»ºç­‘ä¿¡æ¯æ¨¡å‹è§£æä¸æ¸²æŸ“
- ğŸŒ **GeoTIFF 2.1.4** - åœ°ç†æ …æ ¼æ•°æ®å¤„ç†

**UI ç»„ä»¶**

- ğŸ¯ **Element Plus 2.9.10** - æ¡Œé¢ç«¯ç»„ä»¶åº“
- ğŸ§© **@maxtan/ez-ui 0.12.1** - è‡ªç ”ä¸šåŠ¡ç»„ä»¶
- ğŸ¨ **TailwindCSS 6.14.0** - åŸå­åŒ– CSS æ¡†æ¶

**å·¥ç¨‹åŒ–å·¥å…·**

- ğŸ“¦ **pnpm** - é«˜æ•ˆåŒ…ç®¡ç†å™¨
- ğŸ”§ **Prettier + ESLint** - ä»£ç è§„èŒƒä¸æ ¼å¼åŒ–
- ğŸ³ **Docker** - å®¹å™¨åŒ–éƒ¨ç½²

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nuxt 3 åº”ç”¨å±‚ (Pages)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Components (åŸºç¡€ç»„ä»¶)  â”‚  Component (ä¸šåŠ¡ç»„ä»¶)  â”‚ Layouts   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Composables (é€»è¾‘å¤ç”¨)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    APIs (æ¥å£è°ƒç”¨å±‚)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Three.js 3D æ¸²æŸ“å¼•æ“                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
h1-threejs-frontend/
â”œâ”€â”€ apis/              # ğŸ“¡ æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ account.ts      # è´¦æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ project.ts     # é¡¹ç›®ç®¡ç†
â”‚   â”œâ”€â”€ resource.ts    # èµ„æºç®¡ç†
â”‚   â””â”€â”€ system.ts      # ç³»ç»Ÿç®¡ç†
â”‚
â”œâ”€â”€ assets/            # ğŸ¨ é™æ€èµ„æº
â”‚   â””â”€â”€ css/
â”‚       â””â”€â”€ tailwind.css
â”‚
â”œâ”€â”€ component/         # ğŸ§© ä¸šåŠ¡ç»„ä»¶
â”‚   â”œâ”€â”€ BaseModel/     # åŸºç¡€æ¨¡æ€æ¡†
â”‚   â”œâ”€â”€ PlanAndLayout/ # è§„åˆ’å¸ƒå±€
â”‚   â””â”€â”€ process-menu/  # æµç¨‹èœå•
â”‚
â”œâ”€â”€ components/        # ğŸ§± åŸºç¡€ç»„ä»¶
â”‚   â”œâ”€â”€ icon-select/   # å›¾æ ‡é€‰æ‹©å™¨
â”‚   â”œâ”€â”€ layout/        # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ model-wrapper/ # æ¨¡å‹åŒ…è£…å™¨
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ composables/       # âš¡ é€»è¾‘å¤ç”¨
â”‚   â”œâ”€â”€ use-auth.ts           # è®¤è¯é€»è¾‘
â”‚   â”œâ”€â”€ use-base-fetch.ts     # è¯·æ±‚å°è£…
â”‚   â”œâ”€â”€ use-dict.ts           # å­—å…¸ç®¡ç†
â”‚   â”œâ”€â”€ use-model.ts          # æ¨¡å‹ç®¡ç†
â”‚   â”œâ”€â”€ use-three.ts          # Three.js å°è£…
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ pages/             # ğŸ“„ é¡µé¢è·¯ç”±
â”‚   â”œâ”€â”€ home/          # é¦–é¡µ
â”‚   â”œâ”€â”€ ifc/           # IFC æ¨¡å‹ç®¡ç†
â”‚   â”œâ”€â”€ process/       # å·¥è‰ºæµç¨‹ (æ ¸å¿ƒ)
â”‚   â”‚   â”œâ”€â”€ one/       # â‘  åœ°å½¢æµ‹ç»˜
â”‚   â”‚   â”œâ”€â”€ two/       # â‘¡ åŸºç¡€è®¾è®¡
â”‚   â”‚   â”œâ”€â”€ three/     # â‘¢ ç»“æ„è®¾è®¡
â”‚   â”‚   â”œâ”€â”€ four/      # â‘£ æ„ä»¶è®¾è®¡
â”‚   â”‚   â”œâ”€â”€ five/      # â‘¤ éƒ¨ä»¶ç”Ÿäº§
â”‚   â”‚   â”œâ”€â”€ six/       # â‘¥ ç‰©æµè¿è¾“
â”‚   â”‚   â””â”€â”€ seven/     # â‘¦ ç°åœºç»„è£…
â”‚   â”œâ”€â”€ model/         # æ¨¡å‹æ„å»º
â”‚   â”œâ”€â”€ model-library/ # æ¨¡å‹åº“
â”‚   â”œâ”€â”€ system/        # ç³»ç»Ÿç®¡ç†
â”‚   â””â”€â”€ gis.vue        # GIS åœ°å›¾
â”‚
â”œâ”€â”€ plugins/           # ğŸ”Œ æ’ä»¶
â”‚   â””â”€â”€ icons.ts       # å›¾æ ‡æ³¨å†Œ
â”‚
â”œâ”€â”€ public/            # ğŸ“‚ é™æ€æ–‡ä»¶
â”‚   â””â”€â”€ models/        # 3D æ¨¡å‹èµ„æº
â”‚
â”œâ”€â”€ types/             # ğŸ“‹ ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ base.ts        # åŸºç¡€ç±»å‹
â”‚   â”œâ”€â”€ project.ts     # é¡¹ç›®ç±»å‹
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ deploy/            # ğŸš€ éƒ¨ç½²é…ç½®
â”‚   â”œâ”€â”€ prod/          # ç”Ÿäº§ç¯å¢ƒ
â”‚   â”œâ”€â”€ test/          # æµ‹è¯•ç¯å¢ƒ
â”‚   â””â”€â”€ nginx.conf     # Nginx é…ç½®
â”‚
â”œâ”€â”€ nuxt.config.ts     # Nuxt é…ç½®
â””â”€â”€ package.json       # é¡¹ç›®ä¾èµ–
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Node.js 22+** (LTS ç‰ˆæœ¬æ¨è)
- **pnpm 10** (åŒ…ç®¡ç†å·¥å…·)
- ç°ä»£æµè§ˆå™¨ (Chrome 90+, Firefox 88+, Safari 15+)

### å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨ pnpm (æ¨è)
pnpm install

# æˆ–ä½¿ç”¨ npm
npm install
```

### å¼€å‘è¿è¡Œ

```bash
# å¼€å‘æ¨¡å¼ (MODE=DEV)
pnpm dev

# è®¿é—®åœ°å€: http://localhost:3000
```

### æ„å»ºéƒ¨ç½²

```bash
# æµ‹è¯•ç¯å¢ƒæ„å»º
pnpm build:test

# ç”Ÿäº§ç¯å¢ƒæ„å»º
pnpm build

# é¢„è§ˆæ„å»ºç»“æœ
pnpm preview
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env æ–‡ä»¶
MODE=DEV          # å¼€å‘ç¯å¢ƒ
# MODE=TEST       # æµ‹è¯•ç¯å¢ƒ
# MODE=PROD       # ç”Ÿäº§ç¯å¢ƒ
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. IFC/BIM æ¨¡å‹ç®¡ç†

æ”¯æŒ IFC æ ¼å¼å»ºç­‘ä¿¡æ¯æ¨¡å‹çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š

```ts
// æ¨¡å‹åŠ è½½
const { loadIFC } = useModel()
const model = await loadIFC('/models/building.ifc')

// å±æ€§æŸ¥è¯¢
const properties = model.getPropertySets()

// ç©ºé—´åˆ†æ
const spatialData = model.getSpatialStructure()
```

### 2. ä¸ƒé˜¶æ®µå·¥è‰ºæµç¨‹

å·¥ä¸šé¡¹ç›®å…¨ç”Ÿå‘½å‘¨æœŸæ•°å­—åŒ–ç®¡ç†ï¼š

| é˜¶æ®µ       | åŠŸèƒ½         | æ ¸å¿ƒç»„ä»¶                               |
| ---------- | ------------ | -------------------------------------- |
| â‘  åœ°å½¢æµ‹ç»˜ | åœ°å½¢é«˜ç¨‹åˆ†æ | `elevation-map.vue`, `contour-map.vue` |
| â‘¡ åŸºç¡€è®¾è®¡ | åŸºç¡€ç»“æ„è®¾è®¡ | `form.vue` + `render.vue`              |
| â‘¢ ç»“æ„è®¾è®¡ | ä¸»ä½“ç»“æ„å»ºæ¨¡ | Three.js å‚æ•°åŒ–å»ºæ¨¡                    |
| â‘£ æ„ä»¶è®¾è®¡ | æ„ä»¶è¯¦ç»†è®¾è®¡ | IFC æ„ä»¶åº“                             |
| â‘¤ éƒ¨ä»¶ç”Ÿäº§ | ç”Ÿäº§è®¡åˆ’ç®¡ç† | ç®—æ³•ä¼˜åŒ– + ç³»ç»Ÿé…ç½®                    |
| â‘¥ ç‰©æµè¿è¾“ | è¿è¾“è·¯å¾„è§„åˆ’ | GIS ç©ºé—´åˆ†æ                           |
| â‘¦ ç°åœºç»„è£… | æ–½å·¥è¿›åº¦ç®¡æ§ | ç”˜ç‰¹å›¾ + 3D å¯è§†åŒ–                     |

### 3. GIS åœ°ç†ä¿¡æ¯é›†æˆ

äºŒä¸‰ç»´ä¸€ä½“åŒ–åœ°ç†ä¿¡æ¯å±•ç¤ºï¼š

```vue
<template>
  <GisMap :center="[lng, lat]" :zoom="15" @click="handleMapClick" />
</template>
```

### 4. 3D æ¸²æŸ“å¼•æ“

åŸºäº Three.js çš„è‡ªç ”æ¸²æŸ“å°è£…ï¼š

```ts
// composables/use-three.ts
export function useThree() {
  const { scene, camera, renderer } = createRenderer()

  const loadModel = async (url: string) => {
    const model = await loader.load(url)
    scene.add(model)
    return model
  }

  const animate = () => {
    requestAnimationFrame(animate)
    renderer.render(scene, camera)
  }

  return { scene, camera, loadModel, animate }
}
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

1. **TypeScript ä¼˜å…ˆ**

   ```ts
   // âœ… å¥½çš„åšæ³•
   interface Project {
     id: string
     name: string
     status: 'draft' | 'active' | 'completed'
   }

   // âŒ é¿å…
   let project: any = {}
   ```

2. **Composition API æ¨¡å¼**

   ```ts
   // composables/use-project.ts
   export function useProject() {
     const projects = ref<Project[]>([])

     const fetchProjects = async () => {
       projects.value = await api.getProjects()
     }

     return { projects, fetchProjects }
   }
   ```

3. **åŸå­åŒ– CSS**
   ```vue
   <!-- âœ… ä½¿ç”¨ Tailwind å·¥å…·ç±» -->
   <div class="flex flex-col bg-blue-500 text-white p-4 rounded-lg">
     <!-- å†…å®¹ -->
   </div>
   ```

### é¡¹ç›®çº¦å®š

- æ‰€æœ‰ç»„ä»¶ä½¿ç”¨ **Composition API**
- ç±»å‹å®šä¹‰ç»Ÿä¸€æ”¾åœ¨ **types/** ç›®å½•
- ä¸šåŠ¡é€»è¾‘å°è£…åœ¨ **composables/** ä¸­
- æ¥å£è¯·æ±‚ç»Ÿä¸€é€šè¿‡ **apis/** ç®¡ç†
- 3D ç›¸å…³é€»è¾‘ä½¿ç”¨ **use-three.ts** å°è£…

### ç›®å½•ç»“æ„è§„èŒƒ

```
src/
â”œâ”€â”€ apis/          # æ¥å£å®šä¹‰ (æŒ‰ä¸šåŠ¡æ¨¡å—åˆ†æ–‡ä»¶)
â”œâ”€â”€ components/    # åŸºç¡€ç»„ä»¶ (å¯å¤ç”¨çš„UIç»„ä»¶)
â”œâ”€â”€ composables/   # é€»è¾‘å¤ç”¨ (Composition Functions)
â”œâ”€â”€ pages/         # é¡µé¢è·¯ç”± (Nuxtè‡ªåŠ¨è·¯ç”±)
â”œâ”€â”€ types/         # ç±»å‹å®šä¹‰ (å…¨å±€å’Œæ¨¡å—ç±»å‹)
â””â”€â”€ utils/         # å·¥å…·å‡½æ•° (çº¯å‡½æ•°å·¥å…·)
```

### å‘½åè§„èŒƒ

- **æ–‡ä»¶å**: kebab-case (å¦‚ `user-profile.vue`)
- **ç»„ä»¶å**: PascalCase (å¦‚ `UserProfile.vue`)
- **å˜é‡å**: camelCase (å¦‚ `userName`)
- **å¸¸é‡å**: UPPER_SNAKE_CASE (å¦‚ `API_BASE_URL`)
- **æ¥å£å**: PascalCase + `I` å‰ç¼€ (å¦‚ `IUser`)

### Git æäº¤è§„èŒƒ

```
feat: æ–°åŠŸèƒ½
fix: ä¿®å¤bug
chore: æ„å»ºå·¥å…·æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: ä»£ç é‡æ„
perf: æ€§èƒ½ä¼˜åŒ–
test: æµ‹è¯•ç›¸å…³
```

ç¤ºä¾‹: `feat: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½`

### ç»„ä»¶è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£**
2. **è¡¨å•ä¸æ¸²æŸ“åˆ†ç¦»**
3. **é€»è¾‘ä¸è§†å›¾è§£è€¦**
4. **ç±»å‹å®‰å…¨**

### 3D å¼€å‘æœ€ä½³å®è·µ

1. **èµ„æºç®¡ç†**

   ```ts
   // åŠæ—¶é‡Šæ”¾å†…å­˜
   const cleanup = () => {
     geometry.dispose()
     material.dispose()
     renderer.dispose()
   }
   ```

2. **æ€§èƒ½ä¼˜åŒ–**
   - ä½¿ç”¨ LOD (Level of Detail)
   - å®æ–½è§†é”¥å‰”é™¤
   - åˆç†ä½¿ç”¨ Instancing
   - çº¹ç†å‹ç¼©ä¸ mipmaps

## ğŸ“¦ éƒ¨ç½²æ–¹æ¡ˆ

### é•œåƒæºåˆ‡æ¢

é¡¹ç›®é»˜è®¤ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“ï¼Œå¯åˆ‡æ¢ä¸ºå…¬æœ‰é•œåƒï¼š

```dockerfile
# ç§æœ‰é•œåƒ (å½“å‰é…ç½®)
FROM registry.cn-hangzhou.aliyuncs.com/maxtan/node:22.20.0 as builder
FROM registry.cn-hangzhou.aliyuncs.com/maxtan/nginx:1.29.1

# å…¬æœ‰é•œåƒ (æ¨è)
FROM node:22.13.1-alpine as builder
FROM nginx:1.27.3-alpine
```

### å•ä½“åŒ…æ„å»º

```bash
# æ„å»º Docker é•œåƒ
docker build -t h1-threejs-frontend:latest -f deploy/prod/Dockerfile .

# è¿è¡Œå®¹å™¨ (80 ç«¯å£)
docker run -d -p 80:80 h1-threejs-frontend:latest

# è‡ªå®šä¹‰ç«¯å£
docker run -d -p 3000:80 h1-threejs-frontend:latest
```

> ğŸ’¡ é¡¹ç›®é‡‡ç”¨ SPA æ¨¡å¼ (`ssr: false`)ï¼Œæ„å»ºäº§ç‰©ä¸ºçº¯å‰ç«¯å•é¡µåº”ç”¨

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### æ„å»ºä¼˜åŒ–

1. **ä»£ç åˆ†å‰²**

   ```ts
   // åŠ¨æ€å¯¼å…¥
   const HeavyComponent = defineAsyncComponent(() => import('@/components/HeavyComponent.vue'))
   ```

2. **Tree-shaking**
   ```ts
   // åªå¯¼å…¥éœ€è¦çš„å‡½æ•°
   import { ref, computed } from 'vue'
   ```

### è¿è¡Œæ—¶ä¼˜åŒ–

1. **è™šæ‹Ÿæ»šåŠ¨** (å¤§æ•°æ®åˆ—è¡¨)
2. **é˜²æŠ–èŠ‚æµ** (äº‹ä»¶å¤„ç†)
3. **æ‡’åŠ è½½** (å›¾ç‰‡/ç»„ä»¶)
4. **Web Workers** (å¤æ‚è®¡ç®—)

### 3D æ€§èƒ½ä¼˜åŒ–

- **æ¨¡å‹ä¼˜åŒ–**: ä½¿ç”¨ Draco å‹ç¼©ï¼ŒLOD å±‚çº§ç»†èŠ‚
- **çº¹ç†å¤„ç†**: å¯ç”¨å‹ç¼©çº¹ç†æ ¼å¼ (ASTC, ETC)
- **æ¸²æŸ“ä¼˜åŒ–**: åˆæ‰¹æ¸²æŸ“ï¼Œè§†é”¥å‰”é™¤
- **å†…å­˜ç®¡ç†**: åŠæ—¶é‡Šæ”¾ Three.js èµ„æº

### æ„å»ºä¼˜åŒ–

- **ä»£ç åˆ†å‰²**: è·¯ç”±çº§åˆ«åˆ†å‰²ï¼ŒåŠ¨æ€å¯¼å…¥
- **Tree-shaking**: ç§»é™¤æœªä½¿ç”¨ä»£ç 
- **èµ„æºå‹ç¼©**: Gzip/Brotli å‹ç¼©
- **ç¼“å­˜ç­–ç•¥**: é™æ€èµ„æºé•¿æœŸç¼“å­˜
